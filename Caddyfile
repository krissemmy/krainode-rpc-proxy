{
  email {$EMAIL}

  servers {
    timeouts {
      read_body   30s
      read_header 30s
      write       30s
      idle        120s
    }
    # max_header_size 16kb   # (optional)
  }
}

# HTTPS for API
{$API_HOST} {
encode zstd gzip

# (Optional) add CORS headers *here* if you want proxy-level CORS
# header Access-Control-Allow-Origin  https://{$GRAFANA_HOST}
# header Access-Control-Allow-Methods "POST, OPTIONS"
# header Access-Control-Allow-Headers "Content-Type"

# CORS preflight (tweak origin/headers as you need)
@preflight method OPTIONS
header @preflight Access-Control-Allow-Origin "{http.request.header.Origin}"
# header @preflight Access-Control-Allow-Methods "POST, OPTIONS"
header @preflight Access-Control-Allow-Headers "Content-Type, X-API-Key"
header @preflight Access-Control-Max-Age "86400"
# respond @preflight 204

# Proxy to your container network service
reverse_proxy api:8000 {
  header_up X-Forwarded-Proto {scheme}
  header_up X-Forwarded-Host  {host}
}
# Health check endpoint
handle_path /readyz    { reverse_proxy api:8000/readyz }

header {
  Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
}
}